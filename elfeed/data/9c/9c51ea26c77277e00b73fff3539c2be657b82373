<p>In this ~24 minute video I show how to define a prefix key in Emacs
using built-in functionality. The idea is to organise our keys in an
efficient way. Using this method, we can have nested key maps as well,
meaning that the prefix key can have access to the contents of another
map which holds more key bindings. Put simply, we can have “C-z” as a
prefix, “C-z b” as a nested key maps for buffer-related commands, and
“C-z f” for file-related commands. This is a neat way to provide quick
access to our most used commands.</p>

<h2>A variant of what I had in my scratch buffer</h2>

<p>In the video I also talked about the difference between <code class="language-plaintext highlighter-rouge">'</code> and <code class="language-plaintext highlighter-rouge">#'</code>,
as well as what the combination of backtick and comma is about.</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;; Read this to learn about key binding conventions so that you know</span>
<span class="c1">;; which keys are safe for users:</span>
<span class="c1">;;</span>
<span class="c1">;;     (info "(elisp) Key Binding Conventions")</span>

<span class="c1">;; Sample of a generic command with a corresponding key binding</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">test-command</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">message</span> <span class="s">"Hello world"</span><span class="p">))</span>

<span class="p">(</span><span class="nv">keymap-set</span> <span class="nv">global-map</span> <span class="s">"C-z"</span> <span class="nf">#'</span><span class="nv">test-command</span><span class="p">)</span>

<span class="c1">;; Define key maps that will then be added to the prefix map</span>
<span class="p">(</span><span class="nv">defvar-keymap</span> <span class="nv">test-prefix-buffer-map</span>
  <span class="ss">:doc</span> <span class="s">"My prefix key map for buffers."</span>
  <span class="s">"s"</span> <span class="nf">#'</span><span class="nv">save-buffer</span>
  <span class="s">"w"</span> <span class="nf">#'</span><span class="nv">write-file</span>
  <span class="s">"p"</span> <span class="nf">#'</span><span class="nv">previous-buffer</span>
  <span class="s">"n"</span> <span class="nf">#'</span><span class="nv">next-buffer</span><span class="p">)</span>

<span class="p">(</span><span class="nv">defvar-keymap</span> <span class="nv">test-prefix-mode-map</span>
  <span class="ss">:doc</span> <span class="s">"My prefix key map for minor modes."</span>
  <span class="s">"l"</span> <span class="nf">#'</span><span class="nv">display-line-numbers-mode</span>
  <span class="s">"h"</span> <span class="nf">#'</span><span class="nv">hl-line-mode</span><span class="p">)</span>

<span class="c1">;; Define a key map with commands and nested key maps</span>
<span class="p">(</span><span class="nv">defvar-keymap</span> <span class="nv">test-prefix-map</span>
  <span class="ss">:doc</span> <span class="s">"My prefix key map."</span>
  <span class="s">"b"</span> <span class="nv">test-prefix-buffer-map</span>
  <span class="s">"m"</span> <span class="nv">test-prefix-mode-map</span>
  <span class="s">"f"</span> <span class="nf">#'</span><span class="nv">find-file</span>
  <span class="s">"d"</span> <span class="nf">#'</span><span class="nv">dired</span><span class="p">)</span>

<span class="c1">;; Define how the nested keymaps are labelled in `which-key-mode'.</span>
<span class="p">(</span><span class="nv">which-key-add-keymap-based-replacements</span> <span class="nv">test-prefix-map</span>
  <span class="s">"b"</span> <span class="o">`</span><span class="p">(</span><span class="s">"Buffer"</span> <span class="o">.</span> <span class="o">,</span><span class="nv">test-prefix-buffer-map</span><span class="p">)</span>
  <span class="s">"m"</span> <span class="o">`</span><span class="p">(</span><span class="s">"Testing"</span> <span class="o">.</span> <span class="o">,</span><span class="nv">test-prefix-mode-map</span><span class="p">))</span>

<span class="c1">;; Bind the prefix key map to a key.  Notice the absence of a quote for</span>
<span class="c1">;; the map's symbol.</span>
<span class="p">(</span><span class="nv">keymap-set</span> <span class="nv">global-map</span> <span class="s">"C-z"</span> <span class="nv">test-prefix-map</span><span class="p">)</span>
</code></pre></div></div>